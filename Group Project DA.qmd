---
title: "Has Scottish Obesity Prevalence Changed over the Years and do Different Factors Effect this"
author: "Jo Scott-Stephen" "Eleanor Mills" "Sophie Brown"
execute: 
  echo: false
  eval: true
number-sections: true
format:
  html:
    embed-resources: true
editor_options: 
  chunk_output_type: console
---

```{r}
#| echo: false
#| warning: false
#| message: false
library(ggplot2)
library(dplyr)
library(tidyr)
library(tidymodels)
library(sjPlot)
library(performance)
library(kableExtra)
library(gt)
```

```{r}
df <- read.csv("DAProject3.csv")

df <- df %>%
  mutate(
    Sex = as.factor(Sex),
    AgeGroup = as.factor(AgeGroup),
    Veg = as.factor(Veg),
    Fruit = as.factor(Fruit),
    Obese = as.factor(Obese),
    Employment = as.factor(Employment)
  )

df$Employment_Clean <- as.factor(ifelse(df$Employment == "In full-time education" | df$Employment =="In paid employment, self-employed or on gov't training", "Employed/Full-Time Training or Education", ifelse(df$Employment == "Retired", "Retired", "Unemployed/Other")))

df$FV <- as.factor(ifelse(df$Fruit == "Yes" | df$Veg == "Yes", "Yes", "No"))


df$AgeCategory <- as.factor(ifelse(df$AgeGroup %in% c("16-24", "25-34"), "Young",
                    ifelse(df$AgeGroup %in% c("35-44", "45-54", "55-64"), "Middle-aged",
                           "Old")))
df$AgeCategory <- relevel(df$AgeCategory, ref = "Young")

```

# Introduction {#sec-intro}

# Exploratory Analysis {#sec-EA}

# Formal Analysis {#sec-FA}

We will now fit a model to the data.

Since our response variable is binary, we fit a logistic regression model.

$$
Obese \sim Bernoulli(p_i)
$$

Where $p_i$ is the probability of being obese

$$
logit(p_i)= \alpha + \beta_{\text{sex}}\cdot\mathbb{I}_{\text{sex}} + \beta_{\text{year}}\cdot\text{Year} + \beta_{\text{fv}}\cdot\mathbb{I}_{\text{FV}} + \beta_{\text{middle-aged}}\cdot\mathbb{I}_{\text{middle-aged}} + \beta_{\text{old}}\cdot\mathbb{I}_{\text{old}} + \beta_{retired}\cdot\mathbb{I}_{\text{retired}} + \beta_{unemployed}\cdot\mathbb{I}_{\text{unemployed}}
$$

where

-   $\alpha$ is the intercept (the baseline log-odds of obesity when all predictors are at their reference category),

-   $\beta_\text{sex}$ is the coefficient for sex,

-   $\beta_\text{year}$ is the coefficient for survey year,

-   $\beta_\text{fv}$ is the coefficient for whether an individual consumes the daily intake of either fruit, vegetables or both,

-   $\beta_\text{middle-aged}$ is the coefficient for being middle-aged (35-64 years old),

-   $\beta_\text{old}$ is the coefficient for being old (65+ years),

-   $\beta_\text{retired}$ is the coefficient for being retired,

-   $\beta_\text{unemployed}$ is the coefficient for being unemployed or in another non-working status,

-   $\mathbb{I}_{\text{sex}}(x)$ is an indicator function such that

$$
\mathbb{I}_{\mbox{male}}(x) =
\begin{cases}
1 & \mbox{if gender of } x \mbox{ is male}, \\
0 & \mbox{if gender of } x \mbox{ is female}.
\end{cases}
$$
-   $\mathbb{I}_{\text{FV}}(x)$ is an indicator function such that

$$
\mathbb{I}_{\mbox{FV}}(x) =
\begin{cases}
1 & \mbox{if } x \mbox{ consumes the recommended daily intake of fruit and/or vegetables}, \\
0 & \mbox{otherwise}.
\end{cases}
$$

-   $\mathbb{I}_{\text{middle-aged}}(x)$ is an indicator function such that

$$
\mathbb{I}_{\mbox{middle-aged}}(x) =
\begin{cases}
1 & \mbox{if } x \mbox{ is middle-aged (35-64 years old)}, \\
0 & \mbox{otherwise}.
\end{cases}
$$
-   $\mathbb{I}_{\text{old}}(x)$ is an indicator function such that

$$
\mathbb{I}_{\mbox{old}}(x) =
\begin{cases}
1 & \mbox{if } x \mbox{ is old (65+ years old)}, \\
0 & \mbox{otherwise}.
\end{cases}
$$
-   $\mathbb{I}_{\text{retired}}(x)$ is an indicator function such that

$$
\mathbb{I}_{\mbox{retired}}(x) =
\begin{cases}
1 & \mbox{if } x \mbox{ is retired}, \\
0 & \mbox{otherwise}.
\end{cases}
$$
-   $\mathbb{I}_{\text{unemployed}}(x)$ is an indicator function such that

$$
\mathbb{I}_{\mbox{unemployed}}(x) =
\begin{cases}
1 & \mbox{if } x \mbox{ is unemployed or in another non-working status}, \\
0 & \mbox{otherwise}.
\end{cases}
$$


```{r}
#| echo: false
#| label: tbl-sum
#| tbl-cap: Summary Table
model <- glm(Obese ~ Sex + Year + FV + AgeCategory + Employment_Clean, data = df, family = binomial)
model %>% broom::tidy() %>% gt()
AIC(model)
```

| Term               | Estimate | p-value |
|--------------------|----------|---------|
| Intercept          |          |         |
| Sex Male           |          |         |
| Year               |          |         |
| FV yes             |          |         |
| Middle-aged        |          |         |
| Old                |          |         |
| Retired            |          |         |
| Unemployed / Other |          |         |

:: ADD TABLE CAPTION

As predicted from our plots. Obesity rate hasn't changed over the years, so should be remved from the model. However, it seems that the log-odds of Obesity decreases by 0.112 (find new value now changed) if they are male.

```{r}
mod1 <- glm(Obese ~ Year, data = df, family = binomial)
mod1 %>% broom::tidy()%>% gt()
AIC(mod1)
```

# Conclusions {#sec-con}
