---
title: "Has Scottish Obesity Prevalence Changed over the Years and do Different Factors Effect this"
author: "Jo Scott-Stephen" "Eleanor Mills" "Sophie Brown"
execute: 
  echo: false
  eval: true
number-sections: true
format:
  html:
    embed-resources: true
editor_options: 
  chunk_output_type: console
---

```{r}
#| echo: false
#| warning: false
#| message: false
library(ggplot2)
library(dplyr)
library(tidyr)
library(tidymodels)
library(sjPlot)
library(performance)
library(kableExtra)
library(gt)
```


```{r}
df<-read.csv("DAProject3.csv")
df$Sex<-as.factor(df$Sex)
df$AgeGroup<-as.factor(df$AgeGroup)
df$Veg<-as.factor(df$Veg)
df$Fruit<-as.factor(df$Fruit)
df$Obese<-as.factor(df$Obese)
df$Employment<-as.factor(df$Employment)
df$Employment_Clean<-as.factor(ifelse(df$Employment=="In full-time education"|df$Employment=="In paid employment, self-employed or on gov't training", "Employed/Full-Time Training or Education",ifelse(df$Employment=="Retired", "Retired", "Unemployed/Other")))
df$FV<-as.factor(ifelse(df$Fruit=="Yes"|df$Veg=="Yes", "Yes", "No"))
```

# Introduction {#sec-intro}

# Exploratory Analysis {#sec-EA}

# Formal Analysis {#sec-FA}

First we check if obesity prevalence has infact changed over the years in general, not taking any other variables into account. We do that by fitting the following logistic regression model

$$
\begin{align}
\mathrm{Obese}\sim Bernoulli(p_i)\\
\mathrm{logit}(p_i)=\alpha +  \beta_{\text{year}}\cdot\text{year}
\end{align}
$$

```{r}
#| label: tbl-summary1
#| tbl-cap: Results of fitting a logistic regression to see if obesity prevalence changes over the years
mod1 <- glm(Obese ~ Year, data = df, family = binomial)
mod1 %>% broom::tidy()%>% gt()
```

As indicated from our previous plots (add figure number here), Obesity prevalence has seemed to stay rather constant over the years, with a small non-statistically significant increase of 0.0056 in the log-odds of obesity with every passing year. 

We can mores easily visualise this by plotting the probabilities (@fig-prob1), seeing that the probabilities stay rather constant. 

```{r}
#| label: fig-prob1
#| fig-cap: How the probability of obesity changes over the years
plot_model(mod1,
           type = "pred",
           terms = "Year",
           axis.title = c("Year", 
                          "Prob. of Obesity"),
           title = " ")
```

We check the appropriateness of this model fit with the following plots. 

```{r}
#| label: fig-resid1
#| fig-cap: Plots to check model appropriateness
library(performance)
check_model(mod1, panel = TRUE)
```

idk what to say, need to complete this when I have more time

# Conclusions {#sec-con}


